{
  "openapi": "3.0.1",
  "info": {
    "title": "Offender search API Documentation",
    "contact": {
      "name": "Probation Integration Team",
      "url": "https://mojdt.slack.com/archives/C02HQ4M2YQN",
      "email": "probation-integration-team@digital.justice.gov.uk"
    },
    "version": "1.0"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "security": [
    {
      "hmpps-auth-token": []
    }
  ],
  "tags": [
    {
      "name": "address-search",
      "description": "Provides address search features for Delius elastic search"
    },
    {
      "name": "offender-match",
      "description": "Provides offender matching features for Delius elastic search"
    },
    {
      "name": "offender-search",
      "description": "Provides offender search features for Delius elastic search"
    }
  ],
  "paths": {
    "/search": {
      "get": {
        "tags": [
          "offender-search"
        ],
        "summary": "Search for an offender in Delius. Only offenders matching all request attributes will be returned",
        "description": "Specify the request criteria to match against",
        "operationId": "search",
        "parameters": [
          {
            "name": "searchForm",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/SearchDto"
            }
          }
        ],
        "responses": {
          "400": {
            "description": "Invalid Request"
          },
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/OffenderDetail"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "post": {
        "tags": [
          "offender-search"
        ],
        "summary": "Search for an offender in Delius. Only offenders matching all request attributes will be returned",
        "description": "Specify the request criteria to match against",
        "operationId": "search_1",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchDto"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Invalid Request"
          },
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/OffenderDetail"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SearchDto": {
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string"
          },
          "surname": {
            "type": "string"
          },
          "dateOfBirth": {
            "type": "string",
            "format": "date",
            "example": "1996-02-10"
          },
          "pncNumber": {
            "type": "string",
            "example": "2018/0123456X"
          },
          "croNumber": {
            "type": "string",
            "example": "SF80/655108T"
          },
          "crn": {
            "type": "string",
            "example": "X00001"
          },
          "nomsNumber": {
            "type": "string",
            "example": "G5555TT"
          },
          "includeAliases": {
            "type": "boolean",
            "example": false
          }
        }
      },
      "Address": {
        "required": [
          "from",
          "id"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "from": {
            "type": "string",
            "format": "date"
          },
          "to": {
            "type": "string",
            "format": "date"
          },
          "noFixedAbode": {
            "type": "boolean"
          },
          "notes": {
            "type": "string"
          },
          "addressNumber": {
            "type": "string"
          },
          "buildingName": {
            "type": "string"
          },
          "streetName": {
            "type": "string"
          },
          "district": {
            "type": "string"
          },
          "town": {
            "type": "string"
          },
          "county": {
            "type": "string"
          },
          "postcode": {
            "type": "string"
          },
          "telephoneNumber": {
            "type": "string"
          },
          "status": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "type": {
            "$ref": "#/components/schemas/KeyValue"
          }
        }
      },
      "AllTeam": {
        "required": [
          "providerTeamId",
          "teamId"
        ],
        "type": "object",
        "properties": {
          "providerTeamId": {
            "type": "integer",
            "format": "int64"
          },
          "teamId": {
            "type": "integer",
            "format": "int64"
          },
          "code": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "isPrivate": {
            "type": "boolean"
          },
          "externalProvider": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "scProvider": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "localDeliveryUnit": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "district": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "borough": {
            "$ref": "#/components/schemas/KeyValue"
          }
        }
      },
      "ContactDetails": {
        "type": "object",
        "properties": {
          "phoneNumbers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PhoneNumber"
            }
          },
          "emailAddresses": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "allowSMS": {
            "type": "boolean"
          },
          "addresses": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Address"
            }
          }
        }
      },
      "Disability": {
        "type": "object",
        "properties": {
          "disabilityId": {
            "type": "integer",
            "format": "int64"
          },
          "disabilityType": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "condition": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "startDate": {
            "type": "string",
            "format": "date"
          },
          "endDate": {
            "type": "string",
            "format": "date"
          },
          "notes": {
            "type": "string"
          }
        }
      },
      "Human": {
        "type": "object",
        "properties": {
          "forenames": {
            "type": "string",
            "example": "Sheila Linda"
          },
          "surname": {
            "type": "string",
            "example": "Hancock"
          }
        }
      },
      "IDs": {
        "required": [
          "crn"
        ],
        "type": "object",
        "properties": {
          "crn": {
            "type": "string",
            "description": "Probation Case Reference Number",
            "example": "A123456"
          },
          "pncNumber": {
            "type": "string",
            "description": "Police National Computer ID",
            "example": "2012/0052494Q"
          },
          "croNumber": {
            "type": "string",
            "description": "Criminal Records Office Number",
            "example": "123456/24A"
          },
          "niNumber": {
            "type": "string",
            "description": "National Insurance Number",
            "example": "AA123456A"
          },
          "nomsNumber": {
            "type": "string",
            "description": "Prison Offender Number",
            "example": "G5555TT"
          },
          "immigrationNumber": {
            "type": "string"
          },
          "mostRecentPrisonerNumber": {
            "type": "string"
          },
          "previousCrn": {
            "type": "string"
          }
        }
      },
      "Institution": {
        "type": "object",
        "properties": {
          "institutionId": {
            "type": "integer",
            "format": "int64"
          },
          "isEstablishment": {
            "type": "boolean"
          },
          "code": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "institutionName": {
            "type": "string"
          },
          "establishmentType": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "isPrivate": {
            "type": "boolean"
          },
          "nomsPrisonInstitutionCode": {
            "type": "string"
          }
        }
      },
      "KeyValue": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        },
        "description": "Team's borough"
      },
      "MappaDetails": {
        "type": "object",
        "properties": {
          "level": {
            "type": "integer",
            "format": "int32"
          },
          "levelDescription": {
            "type": "string"
          },
          "category": {
            "type": "integer",
            "format": "int32"
          },
          "categoryDescription": {
            "type": "string"
          },
          "startDate": {
            "type": "string",
            "format": "date"
          },
          "reviewDate": {
            "type": "string",
            "format": "date"
          },
          "team": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "officer": {
            "$ref": "#/components/schemas/StaffHuman"
          },
          "probationArea": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "notes": {
            "type": "string"
          }
        }
      },
      "OffenderAlias": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "dateOfBirth": {
            "type": "string",
            "format": "date"
          },
          "firstName": {
            "type": "string"
          },
          "middleNames": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "surname": {
            "type": "string"
          },
          "gender": {
            "type": "string"
          }
        }
      },
      "OffenderDetail": {
        "required": [
          "offenderId",
          "otherIds"
        ],
        "type": "object",
        "properties": {
          "previousSurname": {
            "type": "string"
          },
          "offenderId": {
            "type": "integer",
            "format": "int64"
          },
          "title": {
            "type": "string"
          },
          "firstName": {
            "type": "string"
          },
          "middleNames": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "surname": {
            "type": "string"
          },
          "dateOfBirth": {
            "type": "string",
            "format": "date"
          },
          "gender": {
            "type": "string"
          },
          "otherIds": {
            "$ref": "#/components/schemas/IDs"
          },
          "contactDetails": {
            "$ref": "#/components/schemas/ContactDetails"
          },
          "offenderProfile": {
            "$ref": "#/components/schemas/OffenderProfile"
          },
          "offenderAliases": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OffenderAlias"
            }
          },
          "offenderManagers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OffenderManager"
            }
          },
          "softDeleted": {
            "type": "boolean"
          },
          "currentDisposal": {
            "type": "string"
          },
          "partitionArea": {
            "type": "string"
          },
          "currentRestriction": {
            "type": "boolean"
          },
          "restrictionMessage": {
            "type": "string"
          },
          "currentExclusion": {
            "type": "boolean"
          },
          "exclusionMessage": {
            "type": "string"
          },
          "highlight": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "description": "map of fields which matched a search term (Only return for phrase searching)",
              "example": {
                "surname": [
                  "Smith"
                ],
                "offenderAliases.surname": [
                  "SMITH"
                ]
              },
              "items": {
                "type": "string",
                "description": "map of fields which matched a search term (Only return for phrase searching)",
                "example": "{\"surname\":[\"Smith\"],\"offenderAliases.surname\":[\"SMITH\"]}"
              }
            },
            "description": "map of fields which matched a search term (Only return for phrase searching)",
            "example": {
              "surname": [
                "Smith"
              ],
              "offenderAliases.surname": [
                "SMITH"
              ]
            }
          },
          "accessDenied": {
            "type": "boolean"
          },
          "currentTier": {
            "type": "string"
          },
          "activeProbationManagedSentence": {
            "type": "boolean"
          },
          "mappa": {
            "$ref": "#/components/schemas/MappaDetails"
          },
          "probationStatus": {
            "$ref": "#/components/schemas/ProbationStatus"
          },
          "age": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "OffenderLanguages": {
        "type": "object",
        "properties": {
          "primaryLanguage": {
            "type": "string"
          },
          "otherLanguages": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "languageConcerns": {
            "type": "string"
          },
          "requiresInterpreter": {
            "type": "boolean"
          }
        }
      },
      "OffenderManager": {
        "type": "object",
        "properties": {
          "trustOfficer": {
            "$ref": "#/components/schemas/Human"
          },
          "staff": {
            "$ref": "#/components/schemas/StaffHuman"
          },
          "providerEmployee": {
            "$ref": "#/components/schemas/Human"
          },
          "partitionArea": {
            "type": "string"
          },
          "softDeleted": {
            "type": "boolean"
          },
          "team": {
            "$ref": "#/components/schemas/Team"
          },
          "probationArea": {
            "$ref": "#/components/schemas/ProbationArea"
          },
          "fromDate": {
            "type": "string",
            "format": "date"
          },
          "toDate": {
            "type": "string",
            "format": "date"
          },
          "active": {
            "type": "boolean"
          },
          "allocationReason": {
            "$ref": "#/components/schemas/KeyValue"
          }
        }
      },
      "OffenderProfile": {
        "type": "object",
        "properties": {
          "ethnicity": {
            "type": "string"
          },
          "nationality": {
            "type": "string"
          },
          "secondaryNationality": {
            "type": "string"
          },
          "notes": {
            "type": "string"
          },
          "immigrationStatus": {
            "type": "string"
          },
          "offenderLanguages": {
            "$ref": "#/components/schemas/OffenderLanguages"
          },
          "religion": {
            "type": "string"
          },
          "sexualOrientation": {
            "type": "string"
          },
          "offenderDetails": {
            "type": "string"
          },
          "remandStatus": {
            "type": "string"
          },
          "previousConviction": {
            "$ref": "#/components/schemas/PreviousConviction"
          },
          "riskColour": {
            "type": "string"
          },
          "disabilities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Disability"
            }
          },
          "provisions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Provision"
            }
          }
        }
      },
      "PhoneNumber": {
        "type": "object",
        "properties": {
          "number": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": [
              "TELEPHONE",
              "MOBILE"
            ]
          }
        }
      },
      "PreviousConviction": {
        "type": "object",
        "properties": {
          "convictionDate": {
            "type": "string",
            "format": "date"
          },
          "detail": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          }
        }
      },
      "ProbationArea": {
        "required": [
          "probationAreaId"
        ],
        "type": "object",
        "properties": {
          "probationAreaId": {
            "type": "integer",
            "format": "int64"
          },
          "code": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "nps": {
            "type": "boolean"
          },
          "organisation": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "institution": {
            "$ref": "#/components/schemas/Institution"
          },
          "teams": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AllTeam"
            }
          }
        }
      },
      "ProbationStatus": {
        "required": [
          "awaitingPsr",
          "preSentenceActivity",
          "status"
        ],
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "previouslyKnownTerminationDate": {
            "type": "string",
            "format": "date"
          },
          "inBreach": {
            "type": "boolean"
          },
          "preSentenceActivity": {
            "type": "boolean"
          },
          "awaitingPsr": {
            "type": "boolean"
          }
        }
      },
      "Provision": {
        "type": "object",
        "properties": {
          "provisionId": {
            "type": "integer",
            "format": "int64"
          },
          "provisionType": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "category": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "startDate": {
            "type": "string",
            "format": "date"
          },
          "endDate": {
            "type": "string",
            "format": "date"
          },
          "notes": {
            "type": "string"
          }
        }
      },
      "StaffHuman": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Staff code",
            "example": "AN001A"
          },
          "forenames": {
            "type": "string",
            "description": "Given names",
            "example": "Sheila Linda"
          },
          "surname": {
            "type": "string",
            "description": "Family name",
            "example": "Hancock"
          },
          "unallocated": {
            "type": "boolean",
            "description": "When true the not allocated",
            "example": false
          }
        }
      },
      "Team": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Team code",
            "example": "C01T04"
          },
          "description": {
            "type": "string",
            "description": "Team description",
            "example": "OMU A"
          },
          "telephone": {
            "type": "string",
            "description": "Team telephone, often not populated",
            "example": "OMU A"
          },
          "localDeliveryUnit": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "district": {
            "$ref": "#/components/schemas/KeyValue"
          },
          "borough": {
            "$ref": "#/components/schemas/KeyValue"
          }
        }
      },
      "PageObject": {
        "required": [
          "number",
          "size",
          "totalElements",
          "totalPages"
        ],
        "type": "object",
        "properties": {
          "size": {
            "type": "integer",
            "format": "int64"
          },
          "number": {
            "type": "integer",
            "format": "int64"
          },
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "PageableObject": {
        "type": "object",
        "properties": {
          "unpaged": {
            "type": "boolean"
          },
          "pageNumber": {
            "type": "integer",
            "format": "int32"
          },
          "paged": {
            "type": "boolean"
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          },
          "offset": {
            "type": "integer",
            "format": "int64"
          },
          "sort": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SortObject"
            }
          }
        }
      },
      "SearchPagedResults": {
        "required": [
          "content",
          "empty",
          "first",
          "last",
          "number",
          "numberOfElements",
          "page",
          "pageable",
          "size",
          "sort",
          "total",
          "totalElements",
          "totalPages"
        ],
        "type": "object",
        "properties": {
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OffenderDetail"
            }
          },
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "total": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int64"
          },
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "last": {
            "type": "boolean"
          },
          "size": {
            "type": "integer",
            "format": "int64"
          },
          "number": {
            "type": "integer",
            "format": "int64"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int64"
          },
          "first": {
            "type": "boolean"
          },
          "empty": {
            "type": "boolean"
          },
          "sort": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SortObject"
            }
          },
          "page": {
            "$ref": "#/components/schemas/PageObject"
          }
        }
      },
      "SortObject": {
        "type": "object",
        "properties": {
          "direction": {
            "type": "string"
          },
          "nullHandling": {
            "type": "string"
          },
          "ascending": {
            "type": "boolean"
          },
          "property": {
            "type": "string"
          },
          "ignoreCase": {
            "type": "boolean"
          }
        }
      },
      "ContactSearchRequest": {
        "required": [
          "crn",
          "matchAllTerms",
          "query"
        ],
        "type": "object",
        "properties": {
          "crn": {
            "type": "string"
          },
          "query": {
            "type": "string"
          },
          "matchAllTerms": {
            "type": "boolean"
          }
        }
      },
      "ContactSearchResponse": {
        "required": [
          "page",
          "results",
          "size",
          "totalPages",
          "totalResults"
        ],
        "type": "object",
        "properties": {
          "size": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "totalResults": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int32"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ContactSearchResult"
            }
          }
        }
      },
      "ContactSearchResult": {
        "required": [
          "crn",
          "date",
          "highlights",
          "id",
          "lastUpdatedDateTime",
          "typeCode",
          "typeDescription"
        ],
        "type": "object",
        "properties": {
          "crn": {
            "type": "string"
          },
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "typeCode": {
            "type": "string"
          },
          "typeDescription": {
            "type": "string"
          },
          "outcomeCode": {
            "type": "string"
          },
          "outcomeDescription": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "notes": {
            "type": "string"
          },
          "date": {
            "type": "string",
            "format": "date"
          },
          "startTime": {
            "$ref": "#/components/schemas/LocalTime"
          },
          "endTime": {
            "$ref": "#/components/schemas/LocalTime"
          },
          "lastUpdatedDateTime": {
            "type": "string",
            "format": "date-time"
          },
          "highlights": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      },
      "LocalTime": {
        "type": "object",
        "properties": {
          "hour": {
            "type": "integer",
            "format": "int32"
          },
          "minute": {
            "type": "integer",
            "format": "int32"
          },
          "second": {
            "type": "integer",
            "format": "int32"
          },
          "nano": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "AddressSearchRequest": {
        "required": [
          "boostOptions"
        ],
        "type": "object",
        "properties": {
          "buildingName": {
            "type": "string"
          },
          "addressNumber": {
            "type": "string"
          },
          "streetName": {
            "type": "string"
          },
          "district": {
            "type": "string"
          },
          "town": {
            "type": "string"
          },
          "county": {
            "type": "string"
          },
          "postcode": {
            "type": "string"
          },
          "telephoneNumber": {
            "type": "string"
          },
          "boostOptions": {
            "$ref": "#/components/schemas/BoostOptions"
          }
        }
      },
      "BoostOptions": {
        "required": [
          "postcode",
          "streetName",
          "town"
        ],
        "type": "object",
        "properties": {
          "postcode": {
            "type": "number",
            "format": "float"
          },
          "streetName": {
            "type": "number",
            "format": "float"
          },
          "town": {
            "type": "number",
            "format": "float"
          }
        }
      },
      "LicenceCaseloadRequest": {
        "required": [
          "offset",
          "pageSize",
          "query",
          "sortBy",
          "teamCodes"
        ],
        "type": "object",
        "properties": {
          "teamCodes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "query": {
            "type": "string"
          },
          "sortBy": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SortBy"
            }
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          },
          "offset": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "SortBy": {
        "required": [
          "direction",
          "field"
        ],
        "type": "object",
        "properties": {
          "field": {
            "pattern": "^identifiers\\.crn$|^name\\.forename$|^name\\.surname$|^manager\\.name\\.forename$|^manager\\.name\\.surname$",
            "type": "string"
          },
          "direction": {
            "pattern": "^asc$|^desc$",
            "type": "string"
          }
        }
      },
      "CodedValue": {
        "required": [
          "code",
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        }
      },
      "Identifiers": {
        "required": [
          "crn"
        ],
        "type": "object",
        "properties": {
          "crn": {
            "type": "string"
          },
          "cro": {
            "type": "string"
          },
          "noms": {
            "type": "string"
          },
          "pnc": {
            "type": "string"
          }
        }
      },
      "LicenceCaseloadPerson": {
        "required": [
          "allocationDate",
          "identifiers",
          "manager",
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "$ref": "#/components/schemas/Name"
          },
          "identifiers": {
            "$ref": "#/components/schemas/Identifiers"
          },
          "manager": {
            "$ref": "#/components/schemas/Manager"
          },
          "allocationDate": {
            "type": "string",
            "format": "date"
          }
        }
      },
      "Manager": {
        "required": [
          "code",
          "name",
          "probationArea",
          "team"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "name": {
            "$ref": "#/components/schemas/Name"
          },
          "team": {
            "$ref": "#/components/schemas/Team"
          },
          "probationArea": {
            "$ref": "#/components/schemas/CodedValue"
          }
        }
      },
      "Name": {
        "required": [
          "forename",
          "surname"
        ],
        "type": "object",
        "properties": {
          "surname": {
            "type": "string"
          },
          "forename": {
            "type": "string"
          },
          "middleName": {
            "type": "string"
          }
        }
      },
      "PageMetadata": {
        "type": "object",
        "properties": {
          "size": {
            "type": "integer",
            "format": "int64"
          },
          "number": {
            "type": "integer",
            "format": "int64"
          },
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "PagedModelLicenceCaseloadPerson": {
        "type": "object",
        "properties": {
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LicenceCaseloadPerson"
            }
          },
          "page": {
            "$ref": "#/components/schemas/PageMetadata"
          }
        }
      },
      "SearchPhraseFilter": {
        "required": [
          "matchAllTerms",
          "phrase",
          "probationAreasFilter"
        ],
        "type": "object",
        "properties": {
          "phrase": {
            "type": "string",
            "description": "Phrase containing the terms to search for",
            "example": "john smith 19/07/1965"
          },
          "matchAllTerms": {
            "type": "boolean",
            "description": "When true, only match offenders that match all terms. Analogous to AND versus OR"
          },
          "probationAreasFilter": {
            "type": "array",
            "description": "Filter of probation area codes. Only offenders that have an active offender manager in one of the areas will be returned",
            "example": [
              "N01",
              "N02"
            ],
            "items": {
              "type": "string",
              "description": "Filter of probation area codes. Only offenders that have an active offender manager in one of the areas will be returned",
              "example": "[\"N01\",\"N02\"]"
            }
          }
        }
      },
      "ProbationAreaAggregation": {
        "required": [
          "code",
          "count"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Probation area code",
            "example": "N07"
          },
          "description": {
            "type": "string",
            "description": "Probation area description",
            "example": "London"
          },
          "count": {
            "type": "integer",
            "description": "Count of matching offenders in this area",
            "format": "int64",
            "example": 78
          }
        },
        "description": "Counts of offenders aggregated by probation area"
      },
      "SearchPhraseResults": {
        "required": [
          "content",
          "empty",
          "first",
          "last",
          "number",
          "numberOfElements",
          "page",
          "pageable",
          "probationAreaAggregations",
          "size",
          "sort",
          "total",
          "totalElements",
          "totalPages"
        ],
        "type": "object",
        "properties": {
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OffenderDetail"
            }
          },
          "total": {
            "type": "integer",
            "format": "int64"
          },
          "probationAreaAggregations": {
            "type": "array",
            "description": "Counts of offenders aggregated by probation area",
            "items": {
              "$ref": "#/components/schemas/ProbationAreaAggregation"
            }
          },
          "suggestions": {
            "$ref": "#/components/schemas/Suggest"
          },
          "totalPages": {
            "type": "integer",
            "format": "int64"
          },
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "last": {
            "type": "boolean"
          },
          "size": {
            "type": "integer",
            "format": "int64"
          },
          "number": {
            "type": "integer",
            "format": "int64"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int64"
          },
          "first": {
            "type": "boolean"
          },
          "empty": {
            "type": "boolean"
          },
          "sort": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SortObject"
            }
          },
          "page": {
            "$ref": "#/components/schemas/PageObject"
          }
        }
      },
      "Suggest": {
        "type": "object",
        "properties": {
          "fragment": {
            "type": "boolean"
          }
        },
        "description": "Alternative search phrase suggestions. See https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters.html"
      },
      "MatchRequest": {
        "required": [
          "activeSentence",
          "surname"
        ],
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "description": "Offender first description",
            "example": "john"
          },
          "surname": {
            "type": "string",
            "description": "Offender surname",
            "example": "smith"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Offender date of birth",
            "format": "date",
            "example": "1996-02-10"
          },
          "pncNumber": {
            "type": "string",
            "description": "Police National Computer (PNC) number",
            "example": "2018/0123456X"
          },
          "croNumber": {
            "type": "string",
            "description": "Criminal Records Office (CRO) number",
            "example": "SF80/655108T"
          },
          "nomsNumber": {
            "type": "string",
            "description": "The Offender NOMIS Id (aka prison number/offender no in DPS)",
            "example": "G5555TT"
          },
          "activeSentence": {
            "type": "boolean",
            "description": "Filter so only offenders on a current sentence managed by probation will be returned",
            "example": true
          }
        }
      },
      "OffenderMatch": {
        "required": [
          "offender"
        ],
        "type": "object",
        "properties": {
          "offender": {
            "$ref": "#/components/schemas/OffenderDetail"
          }
        },
        "description": "List of offenders that share the same possibility of being the match"
      },
      "OffenderMatches": {
        "required": [
          "matchedBy",
          "matches"
        ],
        "type": "object",
        "properties": {
          "matches": {
            "type": "array",
            "description": "List of offenders that share the same possibility of being the match",
            "items": {
              "$ref": "#/components/schemas/OffenderMatch"
            }
          },
          "matchedBy": {
            "type": "string",
            "description": "How the match was performed",
            "enum": [
              "ALL_SUPPLIED",
              "ALL_SUPPLIED_ALIAS",
              "HMPPS_KEY",
              "EXTERNAL_KEY",
              "NAME",
              "PARTIAL_NAME",
              "PARTIAL_NAME_DOB_LENIENT",
              "NOTHING"
            ]
          }
        }
      }
    },
    "securitySchemes": {
      "hmpps-auth-token": {
        "type": "http",
        "name": "Authorization",
        "in": "header",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
