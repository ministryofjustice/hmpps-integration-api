{
  "openapi": "3.0.1",
  "info": {
    "title": "Prisoner Search",
    "description": "<div>\n  <h2>Overview</h2>\n  <p>This service provides a number of endpoints for searching and reading prisoners that have been registered with the\n    HMPPS prison service. This may be current or previous prisoners or other people that might be in secure hospitals.</p>\n  <h2>Data provided</h2>\n  <p>The vast majority of the data is sourced from the NOMIS system though in the future this is likely to change as\n    more HMPPS prison data is held outside NOMIS.</p>\n  <p>The data for a person is stored in Elastic Search and is updated after a record in NOMIS is changed. This is\n    typically about a minute after the data is changed in NOMIS. In the unlikely circumstance that your service needs\n    data that is 100% up to date with NOMIS then the <b>prison-api</b> might be a better service to use.\n    One use case this might be appropriate for is if you need up-to-date data at the point a NOMIS prisoner event\n    is received; this service also updates its records as a result of NOMIS prisoner events, so you might encounter a race\n    condition if your read is triggered from the same event.\n  </p>\n  <div>The data returned for each prisoner record is essentially a snapshot of key prisoner data. This includes the\n    following:\n  <ul>\n    <li>Identifiers from both NOMIS and those held in other systems</li>\n    <li>Personal details such as name and date of birth (including aliases)</li>\n    <li>Current prison status such as the current location (including cell)</li>\n    <li>Latest sentence details</li>\n    <li>Alerts</li>\n  </ul>\n  See the schema definition for the API for full details.\n  </div>\n  <h2>Types of endpoints</h2>\n  <h3>Searching for a specific prisoner based on criteria</h3>\n  <p>\n    These are endpoints that use the core Elastic Search features to locate a prisoner record based on a set of criteria;\n    for instance name, date of birth or unique identifier (such as the Police National Computer PNC number).\n    Typically, they return many results and a summary of those results would be presented to an end user.\n  </p>\n  <h3>Matching records</h3>\n  <p>\n    Similar to searching but typically using a criteria from a different system; for instance, key data from a probation\n    record or court record.\n    These will use an algorithm that matches based on data that is likely to be most reliable for matching; for instance,\n    PNC number or name with date of birth.\n  </p>\n  <h3>Retrieving a specific record</h3>\n  <p>\n    Retrieving a specific record typically by a unique identifier; for instance, prisoner number (aka NOMS number). This\n    is a convenient way of viewing a summary of a prisoner record and is typically quicker than using the equivalent API\n    in <b>prison-api</b>.\n  </p>\n  <h3>Retrieving batches of records</h3>\n  <p>\n    Retrieving a batch of records either by supplying a list of identifiers or a criteria that will a match many records;\n    for instance, all people in a prison wing or people to be released on a specific date.\n  </p>\n  <h3>HMPPS Domain Events</h3>\n  <div>\n    This service also raises HMPPS domain events. This is done by analysing deltas when the record is updated in Elastic Search.\n    The specific events currently being raised are\n    <ul>\n      <li>\n        <b>prison-offender-search.prisoner.released</b> is raised when a prisoner is released from prison, this includes temporary releases such as court appearances and transfers\n        <ul>\n          <li><b>eventType</b> string</li>\n          <li><b>occurredAt</b> ISO offset date time - when the release was recorded e.g 2021-02-08T14:41:11.526762Z</li>\n          <li><b>publishedAt</b> ISO offset date time - when this event was first published e.g 2021-06-08T14:41:11.526762+01:00</li>\n          <li><b>version</b> number - version of this event message. Currently <b>1</b></li>\n          <li><b>description</b> string - human-readable description of event</li>\n          <li><b>additionalInformation</b> object - additional information\n            <ul>\n              <li><b>nomsNumber</b> string - NOMIS offender number</li>\n              <li><b>reason</b> enum - reason for the release. Will be one of these values\n                <ul>\n                  <li><b>TEMPORARY_ABSENCE_RELEASE</b> prisoner has been temporarily released and is expected to return</li>\n                  <li><b>RELEASED</b> prisoner has been discharged, typically into the care of probation</li>\n                  <li><b>SENT_TO_COURT</b> prisoner has sent to court</li>\n                  <li><b>TRANSFERRED</b> prisoner is being transferred to another prison</li>\n                </ul>\n              </li>\n              <li><b>detail</b> string - further human-readable information about the reason. The contents is developer focused and not to be relied on. Example<b>Movement reason code YY</b>\n              <li><b>prisonId</b> string - the prison where the prisoner was released from</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <b>prison-offender-search.prisoner.received</b> is raised when a prisoner is received to prison, this may be due to remand, a conviction or a recall from a broken licence. Also included are returns from temporary absences and transfers.\n        <ul>\n          <li><b>eventType</b> string</li>\n          <li><b>occurredAt</b> ISO offset date time - when the receive booking was recorded e.g 2021-02-08T14:41:11.526762Z</li>\n          <li><b>publishedAt</b> ISO offset date time - when this event was first published e.g 2021-06-08T14:41:11.526762+01:00</li>\n          <li><b>version</b> number - version of this event message. Currently <b>1</b></li>\n          <li><b>description</b> string - human readable description of event</li>\n          <li><b>additionalInformation</b> object - additional information\n            <ul>\n              <li><b>nomsNumber</b> string - NOMIS offender number</li>\n              <li><b>reason</b> enum - reason for the receive. Will be one of these values below. It has been observed that administration mistakes in NOMIS can cause the reason for RECALL and CONVICTED to be not always be accurate.\n                <ul>\n                  <li><b>NEW_ADMISSION</b> prisoner is entering prison due to new charges</li>\n                  <li><b>READMISSION</b> prisoner is re-entering prison due to a new court order or recall</li>\n                  <li><b>TEMPORARY_ABSENCE_RETURN</b> prisoner is returning from temporary absence e.g. day release</li>\n                  <li><b>RETURN_FROM_COURT</b> prisoner is returning from court</li>\n                  <li><b>TRANSFERRED</b> prisoner has been transferred from another prison</li>\n                </ul>\n              </li>\n              <li><b>detail</b> string - further human readable information about the reason. The contents is developer focused and not to be relied on. Example<b>Recall referral date 2021-06-13</b>\n              </li>\n              <li><b>prisonId</b> string - the current prison where the prisoner is located</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <b>prison-offender-search.prisoner.updated</b> is raised when a prisoner is updated for any reason. This can be raised alongside the events above.\n        <ul>\n          <li><b>eventType</b> string</li>\n          <li><b>occurredAt</b> ISO offset date time - when the receive booking was recorded e.g 2021-02-08T14:41:11.526762Z</li>\n          <li><b>publishedAt</b> ISO offset date time - when this event was first published e.g 2021-06-08T14:41:11.526762+01:00</li>\n          <li><b>version</b> number - version of this event message. Currently <b>1</b></li>\n          <li><b>description</b> string - human-readable description of event</li>\n          <li><b>additionalInformation</b> object - additional information\n            <ul>\n              <li><b>nomsNumber</b> string - NOMS number of the prisoner</li>\n              <li><b>categoriesChanged</b> string - One of more category of change\n                <ul>\n                  <li><b>IDENTIFIERS</b> key unique identifiers e.g PNC number</li>\n                  <li><b>PERSONAL_DETAILS</b> personal details e.g. firstName</li>\n                  <li><b>ALERTS</b> alert has changed</li>\n                  <li><b>STATUS</b> in/out status or active/inactive status or legal and imprisonment status</li>\n                  <li><b>LOCATION</b> prisoner location and last movement e.g. prisonName</li>\n                  <li><b>SENTENCE</b> current sentence and sentence dates e.g conditionalReleaseDate</li>\n                  <li><b>RESTRICTED_PATIENT</b> restricted hospital patient details have changed e.g. dischargedHospitalId</li>\n                </ul>\n              </li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n      <li>\n        <b>prisoner-offender-search.prisoner.alerts-updated</b> is raised when a prisoner's list of alerts have been amended by either adding or remove one or more.\n        <ul>\n          <li><b>eventType</b> string</li>\n          <li><b>occurredAt</b> ISO offset date time - when the alert change was detected e.g 2021-02-08T14:41:11.526762Z</li>\n          <li><b>publishedAt</b> ISO offset date time - when this event was first published e.g 2021-06-08T14:41:11.526762+01:00</li>\n          <li><b>version</b> number - version of this event message. Currently <b>1</b></li>\n          <li><b>description</b> string - human-readable description of event</li>\n          <li><b>additionalInformation</b> object - additional information\n            <ul>\n              <li><b>nomsNumber</b> string - NOMS number of the prisoner</li>\n              <li><b>bookingId</b> number - booking identifier for latest booking</li>\n              <li><b>alertsAdded</b> array of string - list of DPS alert codes added in this change, typically one or zero</li>\n              <li><b>alertsRemoved</b> array of string - list of DPS alert codes removed in this change, typically one or zero</li>\n            </ul>\n          </li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n  <p>\n    Since these events can only be derived from changes that this service detects these events can not be considered the source of truth\n    but a side effect of other services - NOMIS being the source of the vast majority of changes.\n    So this is a good source when it is important that the Elastic Search datastore has already been updated where otherwise a NOMIS prisoner event could cause a race condition.\n    However, since the majority of changes are sourced by NOMIS amendments the business events reflect what have been entered into NOMIS rather than real world;\n    for example occasionally there maybe a release and receive event in quick succession for the same prisoner simply because there has been some administrative changes in NOMIS rather than the prisoner\n    has actually been released and received within a few minutes. A client might wish to use `prisoner-offender-events` that are delivered slower but are more likely to reflect real world changes rather\n    than just NOMIS changes. If a client is more interested in when changes are made in NOMIS than these services events are more appropriate.\n  </p>\n</div>\n",
    "contact": {
      "name": "HMPPS Digital Studio",
      "email": "feedback@digital.justice.gov.uk"
    },
    "version": "2023-02-02.5289.5d3b67f"
  },
  "servers": [
    {
      "url": "https://prisoner-offender-search-dev.prison.service.justice.gov.uk",
      "description": "Development"
    },
    {
      "url": "https://prisoner-offender-search-preprod.prison.service.justice.gov.uk",
      "description": "PreProd"
    },
    {
      "url": "https://prisoner-offender-search.prison.service.justice.gov.uk",
      "description": "Prod"
    },
    {
      "url": "http://localhost:8080",
      "description": "Local"
    }
  ],
  "security": [
    {
      "bearer-jwt": [
        "read",
        "write"
      ]
    }
  ],
  "tags": [
    {
      "name": "Popular",
      "description": "The most popular endpoints. Look here first when deciding which endpoint to use."
    },
    {
      "name": "Establishment search",
      "description": "Endpoints for searching for a prisoner within a prison"
    },
    {
      "name": "Global search",
      "description": "Endpoints for searching for a prisoner across the entire prison estate, including people that have previously been released"
    },
    {
      "name": "Batch",
      "description": "Endpoints designed to find a large number of prisoners with a single call"
    },
    {
      "name": "Matching",
      "description": "Endpoints designed for matching a prisoner with data from other sources"
    },
    {
      "name": "Deprecated",
      "description": "Endpoints that should no longer be used and will be removed in a future release"
    },
    {
      "name": "Specific use case",
      "description": "Endpoints that were designed for a specific use case and are unlikely to fit for general use"
    },
    {
      "name": "Experimental",
      "description": "Endpoints that have not been tried and tested in a production environment"
    },
    {
      "name": "Elastic Search index maintenance",
      "description": "Endpoints that are to be used by administrators only for maintaining Elasticsearch indices"
    },
    {
      "name": "hmpps-queue-resource",
      "description": "Endpoints that are to be used by administrators only for managing SQS queues. All endpoints require the <b>QUEUE_ADMIN</b> role further information can be found in the <a href=\"https://github.com/ministryofjustice/hmpps-spring-boot-sqs\">hmpps-spring-boot-sqs</a> project"
    },
    {
      "name": "hmpps-queue-resource-async",
      "description": "Endpoints that are to be used by administrators only for managing SQS queues. All endpoints require the <b>QUEUE_ADMIN</b> role further information can be found in the <a href=\"https://github.com/ministryofjustice/hmpps-spring-boot-sqs\">hmpps-spring-boot-sqs</a> project"
    }
  ],
  "paths": {
    "/queue-admin/retry-dlq/{dlqName}": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "retryDlq",
        "parameters": [
          {
            "name": "dlqName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RetryDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/retry-all-dlqs": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "retryAllDlqs",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RetryDlqResult"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/queue-admin/purge-queue/{queueName}": {
      "put": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "purgeQueue",
        "parameters": [
          {
            "name": "queueName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/PurgeQueueResult"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-index/switch-index": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Switch index without rebuilding",
        "description": "current index will be switched both indexed have to be complete, requires PRISONER_INDEX role",
        "operationId": "switchIndex",
        "responses": {
          "409": {
            "description": "Unable to switch indexes - one is marked as in progress or in error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexStatus"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-index/queue-housekeeping": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Performs automated housekeeping tasks such as marking builds completed",
        "description": "This is an internal service which isn't exposed to the outside world. It is called from a Kubernetes CronJob named `index-housekeeping-cronjob`",
        "operationId": "indexQueueHousekeeping",
        "responses": {
          "409": {
            "description": "Unable to marked index complete as it is in error"
          }
        }
      }
    },
    "/prisoner-index/mark-complete": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Mark index as complete and swap",
        "description": "Swaps to the newly built index, requires PRISONER_INDEX role",
        "operationId": "indexComplete",
        "parameters": [
          {
            "name": "ignoreThreshold",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "409": {
            "description": "Unable to marked index complete as it is in error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexStatus"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-index/index/prisoner/{prisonerNumber}": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Index/Refresh Data for Prisoner with specified prisoner Number",
        "description": "Requires PRISONER_INDEX role",
        "operationId": "indexPrisoner",
        "parameters": [
          {
            "name": "prisonerNumber",
            "in": "path",
            "required": true,
            "schema": {
              "pattern": "[a-zA-Z][0-9]{4}[a-zA-Z]{2}",
              "type": "string"
            },
            "example": "A1234AA"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Prisoner"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-index/cancel-index": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Cancels a building index",
        "description": "Only cancels if indexing is in progress, requires PRISONER_INDEX role",
        "operationId": "cancelIndex",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexStatus"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-index/build-index": {
      "put": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "summary": "Start building a new index",
        "description": "Old index is left untouched and will be maintained whilst new index is built, requires PRISONER_INDEX role",
        "operationId": "buildIndex",
        "responses": {
          "409": {
            "description": "Unable to build index - it is marked as in progress or in error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexStatus"
                }
              }
            }
          }
        }
      }
    },
    "/restricted-patient-search/match-restricted-patients": {
      "post": {
        "tags": [
          "Specific use case"
        ],
        "summary": "Match prisoners by criteria",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByCriteria",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RestrictedPatientSearchCriteria"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PagePrisoner"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-search/release-date-by-prison": {
      "post": {
        "tags": [
          "Batch",
          "Specific use case"
        ],
        "summary": "Match prisoners who have a release date within a range, and optionally by prison",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByReleaseDateAndPrison",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReleaseDateSearch"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PagePrisoner"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-search/prisoner-numbers": {
      "post": {
        "tags": [
          "Popular",
          "Batch"
        ],
        "summary": "Match prisoners by a list of prisoner numbers",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByNumbers",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PrisonerNumbers"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prisoner"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-search/possible-matches": {
      "post": {
        "tags": [
          "Matching"
        ],
        "summary": "Search for possible matches by criteria, searching by prison number, PNC number, and/or name and date of birth, returning collated results by order of search. This will also search aliases for possible matches. Use when there is manual input, e.g. a user can select the correct match from search results.",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findPossibleMatchesBySearchCriteria",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PossibleMatchCriteria"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prisoner"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-search/match": {
      "post": {
        "tags": [
          "Deprecated"
        ],
        "summary": "Match prisoners by criteria, to search across a list of specific prisons use /match-prisoners",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByCriteria_1",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PrisonSearch"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prisoner"
                  }
                }
              }
            }
          }
        },
        "deprecated": true
      }
    },
    "/prisoner-search/match-prisoners": {
      "post": {
        "tags": [
          "Matching",
          "Popular"
        ],
        "summary": "Match prisoners by criteria, searching by prisoner identifier or name and returning results for the criteria matched first. Typically used when the matching data is of high quality where the first match is expected to be a near perfect match.",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByCriteria_2",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchCriteria"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prisoner"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-search/booking-ids": {
      "post": {
        "tags": [
          "Batch"
        ],
        "summary": "Match prisoners by a list of booking ids",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByIds",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BookingIds"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prisoner"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/prisoner-detail": {
      "post": {
        "tags": [
          "Global search"
        ],
        "summary": "Find prisoners by exact or wildcard terms for specified fields and return a paginated result set",
        "description": "\n      Search terms and identifiers can be provided in either or mixed case and are converted to the appropriate case.\n      This endpoint will find both exact values (full term matched) or wildcards supporting the '*' and '?' symbols.\n      The '*' symbol will match any number of characters e.g. firstName='J*' will match 'John', 'Jane', and 'James'.  \n      The '?' symbol will match any letter substituted at that position. e.g. firstName='t?ny' will match 'Tony' and 'Tiny'\n      Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role.\n      ",
        "operationId": "prisonerDetailSearch",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PrisonerDetailRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Search successfully performed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PrisonerDetailResponse"
                }
              }
            }
          },
          "400": {
            "description": "Incorrect information provided to perform prisoner match",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Incorrect permissions to search for prisoner data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "ROLE_GLOBAL_SEARCH": []
          },
          {
            "ROLE_PRISONER_SEARCH": []
          }
        ]
      }
    },
    "/match-prisoners": {
      "post": {
        "tags": [
          "Deprecated"
        ],
        "summary": "Match for an prisoner by criteria. This is a more lenient version to other match endpoints that includes alias and fuzzy date of birth matching. It will return the best group of matching prisoners based on the request",
        "description": "Specify the request criteria to match against, role required is ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH",
        "operationId": "matchPrisoners",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MatchRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Search successfully performed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PrisonerMatches"
                }
              }
            }
          },
          "400": {
            "description": "Incorrect information provided to perform prisoner match",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Incorrect permissions to search for prisoner data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "ROLE_GLOBAL_SEARCH": []
          },
          {
            "ROLE_PRISONER_SEARCH": []
          }
        ]
      }
    },
    "/keyword": {
      "post": {
        "tags": [
          "Experimental"
        ],
        "summary": "Search for prisoners by keyword or identifiers within a list of prisons and return a paginated result set",
        "description": " \n      Words and identifiers can be provided in either or mixed case and will be matched against all indexed text and keyword fields.\n      Identifiers within the [and, or, not, exact] terms are detected and converted to the appropriate case.\n      Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role.\n      ",
        "operationId": "keywordSearch",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/KeywordRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Search successfully performed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/KeywordResponse"
                }
              }
            }
          },
          "400": {
            "description": "Incorrect information provided to perform prisoner match",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Incorrect permissions to search for prisoner data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "ROLE_GLOBAL_SEARCH": []
          },
          {
            "ROLE_PRISONER_SEARCH": []
          }
        ]
      }
    },
    "/global-search": {
      "post": {
        "tags": [
          "Popular",
          "Global search"
        ],
        "summary": "Match prisoners by criteria",
        "description": "Requires ROLE_GLOBAL_SEARCH role or ROLE_PRISONER_SEARCH role",
        "operationId": "globalFindByCriteria",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GlobalSearchCriteria"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PagePrisoner"
                }
              }
            }
          }
        }
      }
    },
    "/synthetic-monitor": {
      "get": {
        "tags": [
          "Elastic Search index maintenance"
        ],
        "operationId": "syntheticMonitor",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/queue-admin/get-dlq-messages/{dlqName}": {
      "get": {
        "tags": [
          "hmpps-queue-resource"
        ],
        "operationId": "getDlqMessages",
        "parameters": [
          {
            "name": "dlqName",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "maxMessages",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/GetDlqResult"
                }
              }
            }
          }
        }
      }
    },
    "/prisoner/{id}": {
      "get": {
        "tags": [
          "Popular"
        ],
        "summary": "Get prisoner by prisoner number (AKA NOMS number)",
        "description": "Requires ROLE_PRISONER_SEARCH or ROLE_VIEW_PRISONER_DATA role",
        "operationId": "findByPrisonNumber",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Prisoner"
                }
              }
            }
          }
        },
        "security": [
          {
            "ROLE_VIEW_PRISONER_DATA": []
          },
          {
            "ROLE_PRISONER_SEARCH": []
          }
        ]
      }
    },
    "/prisoner-search/prison/{prisonId}": {
      "get": {
        "tags": [
          "Popular",
          "Batch"
        ],
        "summary": "Get all prisoners in a prison, including restricted patients supported by a POM",
        "description": "Requires ROLE_GLOBAL_SEARCH or ROLE_PRISONER_SEARCH role",
        "operationId": "findByPrison",
        "parameters": [
          {
            "name": "prisonId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "include-restricted-patients",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PagePrisoner"
                }
              }
            }
          }
        }
      }
    },
    "/prison/{prisonId}/prisoners": {
      "get": {
        "tags": [
          "Establishment search",
          "Popular"
        ],
        "summary": "Search for prisoners within a particular prison establishment",
        "description": " \n      This search is optimised for clients that have a simple search term typically containing the prisonser's name\n      or prisoner number. The user typically is certain the prisoner is within the establishment and knows key information \n      about the prisoner.\n      \n      Requires ROLE_PRISONER_IN_PRISON_SEARCH or ROLE_PRISONER_SEARCH role.\n      \n      Sort fields supported are: firstName, lastName, prisonerNumber, dateOfBirth, cellLocation e.g \"sort=firstName,lastName,desc\"\n      \n      Examples:\n      \n      \"/prisoners-in-prison/BXI?term=John&sort=firstName,lastName,desc&page=2&size=20\"\n      This will return all people in HMP Brixton whose first or last names begins with JOHN. \n      Results will be ordered by firstName, lastName descending. \n      Page 3 will be returned with a maximum of 20 results per page.\n      \n      \"/prisoners-in-prison/WWI?sort=cellLocation\"\n      This will return all people in HMP Wandsworth. \n      Results will be ordered by cell location ascending. \n      Page 1 will be returned with a maximum of 10 results per page.\n      \n      \"/prisoners-in-prison/WWI?cellLocationPrefix=WWI-2&term=smith\"\n      \"/prisoners-in-prison/WWI?cellLocationPrefix=2&term=smith\"\n      This will return all people in HMP Wandsworth block 2 whose name starts with SMITH. \n\n      \"/prisoners-in-prison/WWI?cellLocationPrefix=2-A-3-001\"\n      This will return all people in HMP Wandsworth cell WWI-2-A-3-001 \n\n      \"/prisoners-in-prison/WWI?term=A1234KJ\"\n      \"/prisoners-in-prison/WWI?term=A1234KJ bananas\"\n      This will return the single prisoner with prisoner number A1234KJ in HMP Wandsworth. \n      An empty page will be returned if not found\n\n      \"/prisoners-in-prison/WWI?term=A J&fromDob=1956-01-01&toDob=2000-01-02\"\n      This will return all people in HMP Wandsworth. Born on or after 1956-01-01 and on or before 2000-01-02, \n      whose name begins with A J, e.g Alan Jones born on 1956-01-01. \n\n      \"/prisoners-in-prison/WWI?alerts=TACT&alerts=PEEP\"\n      This will return all people in HMP Wandsworth. With the alerts TACT or PEEP.\n\n      ",
        "operationId": "search",
        "parameters": [
          {
            "name": "prisonId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "term",
            "in": "query",
            "description": "The primary search term. Whe absent all prisoners will be returned at the prison",
            "required": false,
            "schema": {
              "type": "string",
              "default": ""
            },
            "example": "john smith"
          },
          {
            "name": "alerts",
            "in": "query",
            "description": "alert codes to filter by. Zero or more can be supplied. When multiple supplied the filter is effectively and OR",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "example": "XTACT"
          },
          {
            "name": "fromDob",
            "in": "query",
            "description": "Offenders with a DOB >= this date",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            },
            "example": "1970-01-02"
          },
          {
            "name": "toDob",
            "in": "query",
            "description": "Offenders with a DOB <= this date",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            },
            "example": "1975-01-02"
          },
          {
            "name": "cellLocationPrefix",
            "in": "query",
            "description": "Filter for the prisoners cell location. A block wing or cell can be specified. With prison id can be included or absent so HEI-3-1 and 3-1 are equivalent when the prison id is HEI",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "3-1"
          },
          {
            "name": "page",
            "in": "query",
            "description": "Zero-based page index (0..N)",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "The size of the page to be returned",
            "required": false,
            "schema": {
              "minimum": 1,
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "lastName,ASC",
                "firstName,ASC",
                "prisonerNumber,ASC"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Search successfully performed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PagePrisoner"
                }
              }
            }
          },
          "400": {
            "description": "Incorrect information provided to perform prisoner match",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized to access this endpoint",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Incorrect permissions to search for prisoner data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "ROLE_PRISONER_IN_PRISON_SEARCH": []
          },
          {
            "ROLE_PRISONER_SEARCH": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "Message": {
        "type": "object",
        "properties": {
          "messageId": {
            "type": "string"
          },
          "receiptHandle": {
            "type": "string"
          },
          "body": {
            "type": "string"
          },
          "attributes": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "messageAttributes": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/MessageAttributeValue"
            }
          },
          "md5OfBody": {
            "type": "string"
          },
          "md5OfMessageAttributes": {
            "type": "string"
          }
        }
      },
      "MessageAttributeValue": {
        "type": "object",
        "properties": {
          "stringValue": {
            "type": "string"
          },
          "binaryValue": {
            "type": "object",
            "properties": {
              "short": {
                "type": "integer",
                "format": "int32"
              },
              "char": {
                "type": "string"
              },
              "int": {
                "type": "integer",
                "format": "int32"
              },
              "long": {
                "type": "integer",
                "format": "int64"
              },
              "float": {
                "type": "number",
                "format": "float"
              },
              "double": {
                "type": "number",
                "format": "double"
              },
              "direct": {
                "type": "boolean"
              },
              "readOnly": {
                "type": "boolean"
              }
            }
          },
          "stringListValues": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "binaryListValues": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "short": {
                  "type": "integer",
                  "format": "int32"
                },
                "char": {
                  "type": "string"
                },
                "int": {
                  "type": "integer",
                  "format": "int32"
                },
                "long": {
                  "type": "integer",
                  "format": "int64"
                },
                "float": {
                  "type": "number",
                  "format": "float"
                },
                "double": {
                  "type": "number",
                  "format": "double"
                },
                "direct": {
                  "type": "boolean"
                },
                "readOnly": {
                  "type": "boolean"
                }
              }
            }
          },
          "dataType": {
            "type": "string"
          }
        }
      },
      "RetryDlqResult": {
        "required": [
          "messages",
          "messagesFoundCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Message"
            }
          }
        }
      },
      "PurgeQueueResult": {
        "required": [
          "messagesFoundCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "IndexStatus": {
        "required": [
          "currentIndex",
          "id",
          "inError",
          "inProgress"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "currentIndex": {
            "type": "string",
            "enum": [
              "INDEX_A",
              "INDEX_B"
            ]
          },
          "startIndexTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "example": "2021-07-05T10:35:17"
          },
          "endIndexTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "example": "2021-07-05T10:35:17"
          },
          "inProgress": {
            "type": "boolean"
          },
          "inError": {
            "type": "boolean"
          }
        }
      },
      "CurrentIncentive": {
        "required": [
          "dateTime",
          "level",
          "nextReviewDate"
        ],
        "type": "object",
        "properties": {
          "level": {
            "$ref": "#/components/schemas/IncentiveLevel"
          },
          "dateTime": {
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",
            "type": "string",
            "description": "Date time of the incentive",
            "example": "2021-07-05T10:35:17"
          },
          "nextReviewDate": {
            "type": "string",
            "description": "Schedule new review date",
            "format": "date",
            "example": "2022-11-10"
          }
        },
        "description": "Incentive level"
      },
      "IncentiveLevel": {
        "required": [
          "description"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "code",
            "example": "STD"
          },
          "description": {
            "type": "string",
            "description": "description",
            "example": "Standard"
          }
        },
        "description": "Incentive level"
      },
      "Prisoner": {
        "required": [
          "dateOfBirth",
          "ethnicity",
          "firstName",
          "gender",
          "lastName",
          "maritalStatus",
          "mostSeriousOffence",
          "nationality",
          "prisonerNumber",
          "religion",
          "restrictedPatient",
          "status",
          "youthOffender"
        ],
        "type": "object",
        "properties": {
          "prisonerNumber": {
            "type": "string",
            "description": "Prisoner Number",
            "example": "A1234AA"
          },
          "pncNumber": {
            "type": "string",
            "description": "PNC Number",
            "example": "12/394773H"
          },
          "pncNumberCanonicalShort": {
            "type": "string",
            "description": "PNC Number",
            "example": "12/394773H"
          },
          "pncNumberCanonicalLong": {
            "type": "string",
            "description": "PNC Number",
            "example": "2012/394773H"
          },
          "croNumber": {
            "type": "string",
            "description": "CRO Number",
            "example": "29906/12J"
          },
          "bookingId": {
            "type": "string",
            "description": "Booking No.",
            "example": "0001200924"
          },
          "bookNumber": {
            "type": "string",
            "description": "Book Number",
            "example": "38412A"
          },
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "Robert"
          },
          "middleNames": {
            "type": "string",
            "description": "Middle Names",
            "example": "John James"
          },
          "lastName": {
            "type": "string",
            "description": "Last name",
            "example": "Larsen"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Date of Birth",
            "format": "date",
            "example": "1975-04-02"
          },
          "gender": {
            "type": "string",
            "description": "Gender",
            "example": "Female"
          },
          "ethnicity": {
            "type": "string",
            "description": "Ethnicity",
            "example": "White: Eng./Welsh/Scot./N.Irish/British"
          },
          "youthOffender": {
            "type": "boolean",
            "description": "Youth Offender?",
            "example": true
          },
          "maritalStatus": {
            "type": "string",
            "description": "Marital Status",
            "example": "Widowed"
          },
          "religion": {
            "type": "string",
            "description": "Religion",
            "example": "Church of England (Anglican)"
          },
          "nationality": {
            "type": "string",
            "description": "Nationality",
            "example": "Egyptian"
          },
          "status": {
            "type": "string",
            "description": "Status of the prisoner",
            "example": "ACTIVE IN"
          },
          "lastMovementTypeCode": {
            "type": "string",
            "description": "Last Movement Type Code of prisoner",
            "example": "CRT"
          },
          "lastMovementReasonCode": {
            "type": "string",
            "description": "Last Movement Reason of prisoner",
            "example": "CA"
          },
          "inOutStatus": {
            "type": "string",
            "description": "In/Out Status",
            "example": "IN",
            "enum": [
              "IN",
              "OUT"
            ]
          },
          "prisonId": {
            "type": "string",
            "description": "Prison ID",
            "example": "MDI"
          },
          "prisonName": {
            "type": "string",
            "description": "Prison Name",
            "example": "HMP Leeds"
          },
          "cellLocation": {
            "type": "string",
            "description": "In prison cell location",
            "example": "A-1-002"
          },
          "aliases": {
            "type": "array",
            "description": "Aliases Names and Details",
            "items": {
              "$ref": "#/components/schemas/PrisonerAlias"
            }
          },
          "alerts": {
            "type": "array",
            "description": "Alerts",
            "items": {
              "$ref": "#/components/schemas/PrisonerAlert"
            }
          },
          "csra": {
            "type": "string",
            "description": "Cell Sharing Risk Assessment",
            "example": "HIGH"
          },
          "category": {
            "type": "string",
            "description": "Prisoner Category",
            "example": "C"
          },
          "legalStatus": {
            "type": "string",
            "description": "Legal Status",
            "example": "SENTENCED",
            "enum": [
              "RECALL",
              "DEAD",
              "INDETERMINATE_SENTENCE",
              "SENTENCED",
              "CONVICTED_UNSENTENCED",
              "CIVIL_PRISONER",
              "IMMIGRATION_DETAINEE",
              "REMAND",
              "UNKNOWN",
              "OTHER"
            ]
          },
          "imprisonmentStatus": {
            "type": "string",
            "description": "The prisoner's imprisonment status code.",
            "example": "LIFE"
          },
          "imprisonmentStatusDescription": {
            "type": "string",
            "description": "The prisoner's imprisonment status description.",
            "example": "Serving Life Imprisonment"
          },
          "mostSeriousOffence": {
            "type": "string",
            "description": "Most serious offence for this sentence",
            "example": "Robbery"
          },
          "recall": {
            "type": "boolean",
            "description": "Indicates that the offender has been recalled",
            "example": false
          },
          "indeterminateSentence": {
            "type": "boolean",
            "description": "Indicates the the offender has an indeterminate sentence",
            "example": true
          },
          "sentenceStartDate": {
            "type": "string",
            "description": "Start Date for this sentence",
            "format": "date",
            "example": "2020-04-03"
          },
          "releaseDate": {
            "type": "string",
            "description": "Actual of most likely Release Date",
            "format": "date",
            "example": "2023-05-02"
          },
          "confirmedReleaseDate": {
            "type": "string",
            "description": "Release Date Confirmed",
            "format": "date",
            "example": "2023-05-01"
          },
          "sentenceExpiryDate": {
            "type": "string",
            "description": "Sentence Expiry Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "licenceExpiryDate": {
            "type": "string",
            "description": "Licence Expiry Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "homeDetentionCurfewEligibilityDate": {
            "type": "string",
            "description": "HDC Eligibility Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "homeDetentionCurfewActualDate": {
            "type": "string",
            "description": "HDC Actual Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "homeDetentionCurfewEndDate": {
            "type": "string",
            "description": "HDC End Date",
            "format": "date",
            "example": "2023-05-02"
          },
          "topupSupervisionStartDate": {
            "type": "string",
            "description": "Top-up supervision start date",
            "format": "date",
            "example": "2023-04-29"
          },
          "topupSupervisionExpiryDate": {
            "type": "string",
            "description": "Top-up supervision expiry date",
            "format": "date",
            "example": "2023-05-01"
          },
          "additionalDaysAwarded": {
            "type": "integer",
            "description": "Days added to sentence term due to adjustments.",
            "format": "int32",
            "example": 10
          },
          "nonDtoReleaseDate": {
            "type": "string",
            "description": "Release date for Non determinant sentence (if applicable). This will be based on one of ARD, CRD, NPD or PRRD.",
            "format": "date",
            "example": "2023-05-01"
          },
          "nonDtoReleaseDateType": {
            "type": "string",
            "description": "Indicates which type of non-DTO release date is the effective release date. One of 'ARD, 'CRD, NPD or 'PRRD.",
            "example": "ARD",
            "enum": [
              "ARD",
              "CRD",
              "NPD",
              "PRRD"
            ]
          },
          "receptionDate": {
            "type": "string",
            "description": "Date prisoner was received into the prison",
            "format": "date",
            "example": "2023-05-01"
          },
          "paroleEligibilityDate": {
            "type": "string",
            "description": "Parole  Eligibility Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "automaticReleaseDate": {
            "type": "string",
            "description": "Automatic Release Date. If automaticReleaseOverrideDate is available then it will be set as automaticReleaseDate",
            "format": "date",
            "example": "2023-05-01"
          },
          "postRecallReleaseDate": {
            "type": "string",
            "description": "Post Recall Release Date. if postRecallReleaseOverrideDate is available then it will be set as postRecallReleaseDate",
            "format": "date",
            "example": "2023-05-01"
          },
          "conditionalReleaseDate": {
            "type": "string",
            "description": "Conditional Release Date. If conditionalReleaseOverrideDate is available then it will be set as conditionalReleaseDate",
            "format": "date",
            "example": "2023-05-01"
          },
          "actualParoleDate": {
            "type": "string",
            "description": "Actual Parole Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "tariffDate": {
            "type": "string",
            "description": "Tariff Date",
            "format": "date",
            "example": "2023-05-01"
          },
          "locationDescription": {
            "type": "string",
            "description": "current prison or outside with last movement information.",
            "example": "Outside - released from Leeds"
          },
          "restrictedPatient": {
            "type": "boolean",
            "description": "Indicates a restricted patient",
            "example": true
          },
          "supportingPrisonId": {
            "type": "string",
            "description": "Supporting prison ID for POM",
            "example": "LEI"
          },
          "dischargedHospitalId": {
            "type": "string",
            "description": "Which hospital the offender has been discharged to",
            "example": "HAZLWD"
          },
          "dischargedHospitalDescription": {
            "type": "string",
            "description": "Hospital name to which the offender was discharged",
            "example": "Hazelwood House"
          },
          "dischargeDate": {
            "type": "string",
            "description": "Date of discharge",
            "format": "date",
            "example": "2020-05-01"
          },
          "dischargeDetails": {
            "type": "string",
            "description": "Any additional discharge details",
            "example": "Psychiatric Hospital Discharge to Hazelwood House"
          },
          "currentIncentive": {
            "$ref": "#/components/schemas/CurrentIncentive"
          }
        }
      },
      "PrisonerAlert": {
        "required": [
          "active",
          "alertCode",
          "alertType",
          "expired"
        ],
        "type": "object",
        "properties": {
          "alertType": {
            "type": "string",
            "description": "Alert Type",
            "example": "H"
          },
          "alertCode": {
            "type": "string",
            "description": "Alert Code",
            "example": "HA"
          },
          "active": {
            "type": "boolean",
            "description": "Active",
            "example": true
          },
          "expired": {
            "type": "boolean",
            "description": "Expired",
            "example": true
          }
        },
        "description": "Alerts"
      },
      "PrisonerAlias": {
        "required": [
          "dateOfBirth",
          "firstName",
          "lastName"
        ],
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "Robert"
          },
          "middleNames": {
            "type": "string",
            "description": "Middle names",
            "example": "Trevor"
          },
          "lastName": {
            "type": "string",
            "description": "Last name",
            "example": "Lorsen"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Date of birth",
            "format": "date",
            "example": "1975-04-02"
          },
          "gender": {
            "type": "string",
            "description": "Gender",
            "example": "Male"
          },
          "ethnicity": {
            "type": "string",
            "description": "Ethnicity",
            "example": "White : Irish"
          }
        },
        "description": "Aliases Names and Details"
      },
      "RestrictedPatientSearchCriteria": {
        "type": "object",
        "properties": {
          "prisonerIdentifier": {
            "type": "string",
            "description": "Prisoner identifier, one of prisoner number, book number, booking ID or PNC",
            "example": "A1234AA,"
          },
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "John"
          },
          "lastName": {
            "type": "string",
            "description": "Last Name",
            "example": "Smith"
          },
          "supportingPrisonIds": {
            "type": "array",
            "description": "List of supporting Prison Ids to restrict the search by. Unrestricted if not supplied or null",
            "example": [
              "MDI"
            ],
            "items": {
              "type": "string",
              "description": "List of supporting Prison Ids to restrict the search by. Unrestricted if not supplied or null",
              "example": "[\"MDI\"]"
            }
          }
        },
        "description": "Search Criteria for Prisoner Search"
      },
      "PagePrisoner": {
        "type": "object",
        "properties": {
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int32"
          },
          "size": {
            "type": "integer",
            "format": "int32"
          },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prisoner"
            }
          },
          "number": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "first": {
            "type": "boolean"
          },
          "last": {
            "type": "boolean"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int32"
          },
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "PageableObject": {
        "type": "object",
        "properties": {
          "offset": {
            "type": "integer",
            "format": "int64"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "paged": {
            "type": "boolean"
          },
          "unpaged": {
            "type": "boolean"
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          },
          "pageNumber": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "SortObject": {
        "type": "object",
        "properties": {
          "empty": {
            "type": "boolean"
          },
          "unsorted": {
            "type": "boolean"
          },
          "sorted": {
            "type": "boolean"
          }
        }
      },
      "ReleaseDateSearch": {
        "required": [
          "latestReleaseDate"
        ],
        "type": "object",
        "properties": {
          "earliestReleaseDate": {
            "type": "string",
            "description": "The lower bound for the release date range of which to search - defaults to today if not provided",
            "format": "date",
            "example": "2022-04-20"
          },
          "latestReleaseDate": {
            "type": "string",
            "description": "The upper bound for the release date range of which to search. A required field.",
            "format": "date",
            "example": "2022-05-20"
          },
          "prisonIds": {
            "uniqueItems": true,
            "type": "array",
            "description": "List of Prison Ids (can include OUT and TRN) to restrict the search by. Unrestricted if not supplied or null",
            "example": [
              "MDI"
            ],
            "items": {
              "type": "string",
              "description": "List of Prison Ids (can include OUT and TRN) to restrict the search by. Unrestricted if not supplied or null",
              "example": "[\"MDI\"]"
            }
          }
        },
        "description": "Search Criteria for Release Date Search"
      },
      "PrisonerNumbers": {
        "required": [
          "prisonerNumbers"
        ],
        "type": "object",
        "properties": {
          "prisonerNumbers": {
            "maxItems": 1000,
            "minItems": 1,
            "type": "array",
            "description": "List of prisoner numbers to search by",
            "example": [
              "A1234AA"
            ],
            "items": {
              "type": "string",
              "description": "List of prisoner numbers to search by",
              "example": "[\"A1234AA\"]"
            }
          }
        }
      },
      "PossibleMatchCriteria": {
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "description": "Prisoner first name",
            "example": "john"
          },
          "lastName": {
            "type": "string",
            "description": "Prisoner last Name",
            "example": "smith"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Prisoner date of birth",
            "format": "date",
            "example": "1996-02-10"
          },
          "pncNumber": {
            "type": "string",
            "description": "Police National Computer (PNC) number (This will match both long and short PNC formats)",
            "example": "2018/0123456X"
          },
          "nomsNumber": {
            "type": "string",
            "description": "The Prisoner NOMIS Id (aka prison number/offender no in DPS)",
            "example": "A1234AB"
          }
        },
        "description": "Search Criteria for possible match"
      },
      "PrisonSearch": {
        "required": [
          "includeAliases"
        ],
        "type": "object",
        "properties": {
          "prisonerIdentifier": {
            "type": "string",
            "description": "Prisoner identifier, one of prisoner number, book number, booking ID or PNC",
            "example": "A1234AA,"
          },
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "John"
          },
          "lastName": {
            "type": "string",
            "description": "Last Name",
            "example": "Smith"
          },
          "prisonId": {
            "type": "string",
            "description": "Prison Id, Prison Id or OUT or TRN",
            "example": "MDI"
          },
          "includeAliases": {
            "type": "boolean",
            "description": "Include aliases in search",
            "example": false,
            "default": false
          }
        },
        "description": "Search Criteria for Prisoner Search"
      },
      "SearchCriteria": {
        "required": [
          "includeAliases"
        ],
        "type": "object",
        "properties": {
          "prisonerIdentifier": {
            "type": "string",
            "description": "Prisoner identifier, one of prisoner number, book number, booking ID or PNC",
            "example": "A1234AA,"
          },
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "John"
          },
          "lastName": {
            "type": "string",
            "description": "Last Name",
            "example": "Smith"
          },
          "prisonIds": {
            "type": "array",
            "description": "List of Prison Ids (can include OUT and TRN) to restrict the search by. Unrestricted if not supplied or null",
            "example": [
              "MDI"
            ],
            "items": {
              "type": "string",
              "description": "List of Prison Ids (can include OUT and TRN) to restrict the search by. Unrestricted if not supplied or null",
              "example": "[\"MDI\"]"
            }
          },
          "includeAliases": {
            "type": "boolean",
            "description": "Include aliases in search",
            "example": false,
            "default": false
          }
        },
        "description": "Search Criteria for Prisoner Search"
      },
      "BookingIds": {
        "required": [
          "bookingIds"
        ],
        "type": "object",
        "properties": {
          "bookingIds": {
            "maxItems": 1000,
            "minItems": 1,
            "type": "array",
            "description": "List of bookingIds to search by",
            "example": [
              1,
              2,
              3
            ],
            "items": {
              "type": "integer",
              "description": "List of bookingIds to search by",
              "format": "int64"
            }
          }
        }
      },
      "PaginationRequest": {
        "required": [
          "page",
          "size"
        ],
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "description": "The page number required in the paginated response",
            "format": "int32",
            "example": 0
          },
          "size": {
            "type": "integer",
            "description": "The number of results to return for paginated response",
            "format": "int32",
            "example": 10
          }
        },
        "description": "Pagination options. Will default to the first page if omitted."
      },
      "PrisonerDetailRequest": {
        "required": [
          "includeAliases",
          "pagination",
          "prisonIds"
        ],
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "description": "Prisoner first name",
            "example": "john"
          },
          "lastName": {
            "type": "string",
            "description": "Prisoner last name",
            "example": "smith"
          },
          "nomsNumber": {
            "type": "string",
            "description": "Prisoner number (aka. offenderId, nomisId)",
            "example": "A1234AA"
          },
          "pncNumber": {
            "type": "string",
            "description": "Police National Computer (PNC) number",
            "example": "2018/0123456X"
          },
          "croNumber": {
            "type": "string",
            "description": "Criminal Records Office (CRO) number",
            "example": "SF80/655108T"
          },
          "fuzzyMatch": {
            "type": "boolean",
            "description": "Fuzzy matching. Allow a one character difference in spelling in word lengths below five and two differences above.",
            "example": false
          },
          "prisonIds": {
            "type": "array",
            "description": "List of prison codes to filter results by",
            "example": "['LEI', 'MDI']",
            "items": {
              "type": "string",
              "description": "List of prison codes to filter results by",
              "example": "['LEI', 'MDI']"
            }
          },
          "includeAliases": {
            "type": "boolean",
            "description": "Include aliases in search",
            "example": true,
            "default": true
          },
          "pagination": {
            "$ref": "#/components/schemas/PaginationRequest"
          }
        }
      },
      "PrisonerDetailResponse": {
        "type": "object",
        "properties": {
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int32"
          },
          "size": {
            "type": "integer",
            "format": "int32"
          },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prisoner"
            }
          },
          "number": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "first": {
            "type": "boolean"
          },
          "last": {
            "type": "boolean"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int32"
          },
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "ErrorResponse": {
        "required": [
          "errorCode",
          "status",
          "userMessage"
        ],
        "type": "object",
        "properties": {
          "status": {
            "type": "integer",
            "description": "Status of Error Code",
            "format": "int32",
            "example": 400
          },
          "developerMessage": {
            "type": "string",
            "description": "Developer Information message",
            "example": "System is down"
          },
          "errorCode": {
            "type": "integer",
            "description": "Internal Error Code",
            "format": "int32",
            "example": 20012
          },
          "userMessage": {
            "type": "string",
            "description": "Error message information",
            "example": "Prisoner Not Found"
          },
          "moreInfo": {
            "type": "string",
            "description": "Additional information about the error",
            "example": "Hard disk failure"
          }
        }
      },
      "MatchRequest": {
        "required": [
          "lastName"
        ],
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "description": "Prisoner first name",
            "example": "john"
          },
          "lastName": {
            "type": "string",
            "description": "Prisoner last Name",
            "example": "smith"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Prisoner date of birth",
            "format": "date",
            "example": "1996-02-10"
          },
          "pncNumber": {
            "type": "string",
            "description": "Police National Computer (PNC) number",
            "example": "2018/0123456X"
          },
          "croNumber": {
            "type": "string",
            "description": "Criminal Records Office (CRO) number",
            "example": "SF80/655108T"
          },
          "nomsNumber": {
            "type": "string",
            "description": "The Prisoner NOMIS Id (aka prison number/offender no in DPS)",
            "example": "A1234AB"
          }
        }
      },
      "PrisonerMatch": {
        "required": [
          "prisoner"
        ],
        "type": "object",
        "properties": {
          "prisoner": {
            "$ref": "#/components/schemas/Prisoner"
          }
        },
        "description": "List of prisoners that share the same possibility of being the match"
      },
      "PrisonerMatches": {
        "required": [
          "matchedBy",
          "matches"
        ],
        "type": "object",
        "properties": {
          "matches": {
            "type": "array",
            "description": "List of prisoners that share the same possibility of being the match",
            "items": {
              "$ref": "#/components/schemas/PrisonerMatch"
            }
          },
          "matchedBy": {
            "type": "string",
            "description": "How the match was performed",
            "enum": [
              "ALL_SUPPLIED",
              "ALL_SUPPLIED_ALIAS",
              "HMPPS_KEY",
              "EXTERNAL_KEY",
              "NAME",
              "PARTIAL_NAME",
              "PARTIAL_NAME_DOB_LENIENT",
              "NOTHING"
            ]
          }
        }
      },
      "KeywordRequest": {
        "required": [
          "pagination",
          "prisonIds",
          "type"
        ],
        "type": "object",
        "properties": {
          "orWords": {
            "type": "string",
            "description": "Match where any of the keywords are present in any text field",
            "example": "smith james john"
          },
          "andWords": {
            "type": "string",
            "description": "Match where all keywords are present in any text field",
            "example": "smith james"
          },
          "notWords": {
            "type": "string",
            "description": "Filter results where any of these words are present in any text field",
            "example": "jonas"
          },
          "exactPhrase": {
            "type": "string",
            "description": "Match only prisoners where the full phrase is present in any text field",
            "example": "John Smith"
          },
          "fuzzyMatch": {
            "type": "boolean",
            "description": "Fuzzy matching. Allow a one character difference in spelling in word lengths below five and two differences above.",
            "example": false
          },
          "prisonIds": {
            "type": "array",
            "description": "List of prison codes to filter results",
            "example": [
              "LEI",
              "MDI"
            ],
            "items": {
              "type": "string",
              "description": "List of prison codes to filter results",
              "example": "[\"LEI\",\"MDI\"]"
            }
          },
          "pagination": {
            "$ref": "#/components/schemas/PaginationRequest"
          },
          "type": {
            "type": "string",
            "description": "The type of search. When set to DEFAULT (which is the default when not provided) search order is by calculated relevance (AKA score). An ESTABLISHMENT type will order results by name and is designed for using this API for a single quick search field for prisoners within a specific prison",
            "enum": [
              "DEFAULT",
              "ESTABLISHMENT"
            ]
          }
        }
      },
      "KeywordResponse": {
        "type": "object",
        "properties": {
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int32"
          },
          "size": {
            "type": "integer",
            "format": "int32"
          },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prisoner"
            }
          },
          "number": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "first": {
            "type": "boolean"
          },
          "last": {
            "type": "boolean"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int32"
          },
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "GlobalSearchCriteria": {
        "required": [
          "includeAliases"
        ],
        "type": "object",
        "properties": {
          "prisonerIdentifier": {
            "type": "string",
            "description": "Prisoner identifier, one of prisoner number, book number, booking ID or PNC",
            "example": "A1234AA"
          },
          "firstName": {
            "type": "string",
            "description": "First Name",
            "example": "John"
          },
          "lastName": {
            "type": "string",
            "description": "Last Name",
            "example": "Smith"
          },
          "gender": {
            "type": "string",
            "description": "Gender, F - Female, M - Male, NK - Not Known / Not Recorded or NS - Not Specified (Indeterminate)",
            "example": "M",
            "enum": [
              "M",
              "F",
              "NK",
              "NS",
              "ALL"
            ]
          },
          "location": {
            "type": "string",
            "description": "Location, All or Inside or Outside",
            "example": "IN"
          },
          "dateOfBirth": {
            "type": "string",
            "description": "Date of birth",
            "format": "date",
            "example": "1970-02-28"
          },
          "includeAliases": {
            "type": "boolean",
            "description": "Include aliases in search",
            "example": false,
            "default": false
          }
        },
        "description": "Search Criteria for Global Prisoner Search"
      },
      "DlqMessage": {
        "required": [
          "body",
          "messageId"
        ],
        "type": "object",
        "properties": {
          "body": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "messageId": {
            "type": "string"
          }
        }
      },
      "GetDlqResult": {
        "required": [
          "messages",
          "messagesFoundCount",
          "messagesReturnedCount"
        ],
        "type": "object",
        "properties": {
          "messagesFoundCount": {
            "type": "integer",
            "format": "int32"
          },
          "messagesReturnedCount": {
            "type": "integer",
            "format": "int32"
          },
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DlqMessage"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "bearer-jwt": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
