# Data Analysis Tooling <!-- omit in toc -->

## Contents <!-- omit in toc -->
This repository contains Python scripts and modules for various tooling purposes.

- [Requirements](#requirements)
- [Installation](#installation)
- [Scripts](#scripts)
  - [Retrieve Schemas and their fields from Prison API](#retrieve-schemas-and-their-fields-from-prison-api)
  - [Generate a Schema space diagram, output child-parent relations](#generate-a-schema-space-diagram-output-child-parent-relations)
  - [Retrieve Endpoints for provided list of schemas](#retrieve-endpoints-for-provided-list-of-schemas)
- [Modules](#modules)
  - [Constants](#constants)
- [Contributing](#contributing)

## Requirements

Before running the scripts in this repository, make sure you have the following:

- Python 3.7 or above
- Virtual environment - included in Installation instructions below

## Installation

To set up the virtual environment, you can create your own preference, or you can use the provided `requirements.txt` file:

```shell
pip3 install -r requirements.txt
```

## Scripts
### Retrieve Schemas and their fields from Prison API
[retrieve_schema_fields.py](retrieve_schema_fields.py)
To run this script *from within the tooling folder*, based on your python distribution:

```shell
python3 retrieve_schema_fields.py
```
>Outputs:
> - A csv file in the [outputs](outputs) directory containing schemas and fields within them

### Generate a Schema space diagram, output child-parent relations
[generate_schema_diagram.py](generate_schema_diagram.py)
There are several options for the running of this script:
- Search for one schema
- Search for multiple schema
- No Search option - generate full diagram

To run this script *from within the tooling folder*, based on your Python distribution:
- Search for one schema, where the argument is a schema name in a string format
```shell
python3 generate_schema_diagram.py "AddressDto"
```
- Search for mulitiple schemas, where the arguments are all strings of schema names:
```shell
python3 generate_schema_diagram.py "AddressDto" "SentenceCalcDates"
```
- No search option, generating a full diagram:
```shell
python3 generate_schema_diagram.py
```

>Outputs
> - A csv file with the parent child relations of schemas.
> - A diagram in .dot format, renderable in plantuml or local graphviz renderer, of the schema relations

### Retrieve Endpoints for provided list of schemas
[discover_schema_endpoints.py](discover_schema_endpoints.py)
This script:
- Takes as an input a csv file of parent-child schema relations (defaults to the schema_parent_child.csv file generated by another script)
  - Note that the input file MUST contain as a subset the following columns in any order: `Parent_Schema`, `Field`, `Child_Schema`, `Searched_bool`
- Returns as a csv file a table of relevant endpoints to all parent and children schemas in the provided file. The endpoints are for successful response types only (i.e. `2XX`)
  - The output file is tabulated with the following columns: `Path`, `HTTP_method`, `HTTP_response`, `Schema`
To run this script *from within the [data_analysis](../data_analysis/)s folder*:

```shell
python3 discover_schema_endpoints.py
```
OR you can manually specify a file to load in with:
```shell
python3 discover_schema_endpoints.py "outputs/some_other_file.csv"
```
Noting that the file must contain expected columns

## Modules
This repository contains the following Python modules:

### Constants
There is a [constants](constants) directory, initialised to be a module directory, containing [constants and common objects](constants/common.py) used by the scripts.
This allows you to edit constants in one location, without having to amend other scripts in the base [data_analysis](../data_analysis/) directory.
Feel free to explore them for more functionality.

## Contributing
Contributions to this tooling section are welcome, as long as they can be executed in Python. Autodocumentation is a potential and the desire is to keep this option open as this tooling section expands.
