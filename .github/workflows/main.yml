name: Generate PlantUML Diagrams

on: 
  - workflow_dispatch
  - push
    
jobs: 
  generate-diagrams:
    runs-on: ubuntu-latest
    defaults:
      run: 
        working-directory: ./docs/diagrams
    steps:
    - uses: actions/checkout@v3
    - name: Download Graphviz Dependency
      run: |
        sudo apt-get install graphviz
    - name: Download PlantUML
      run: |
        wget https://github.com/plantuml/plantuml/releases/download/v1.2023.1/plantuml.jar
        java -jar plantuml.jar -version
    - name: Generate Diagrams
      run: | 
        java -jar plantuml.jar *.puml
    - name: Setup Git Config
      run: |
        git config user.name "Github Actions Bot"
        git config user.email "<>"
    - name: Commit images
      run: |
        git show-ref
        git add *.png
        git commit -m "Refreshed Plantuml diagrams" || true
        git push origin HEAD:main 
